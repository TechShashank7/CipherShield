<!DOCTYPE html>
<html>
<head>
    <title>Cyber Immunity Challenge</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>

<div class="container">

    <h1>Cyber Immunity Challenge</h1>
    <p>Round {{ round }} of 7</p>

    <div class="score-box">
        <strong>Current Cyber Risk Score:</strong> {{ risk }}
    </div>

    <div class="card">
        <h3>Analyze the Message Carefully</h3>

        <div class="simulation-box">
            {{ scenario.message }}
        </div>

        <form id="challengeForm">
            <h4>What looks suspicious? (Select all that apply)</h4>

            <label><input type="checkbox" name="flags" value="link"> Suspicious Link</label><br>
            <label><input type="checkbox" name="flags" value="authority"> Authority Misuse</label><br>
            <label><input type="checkbox" name="flags" value="urgency"> Urgency Tactic</label><br>
            <label><input type="checkbox" name="flags" value="reward"> Reward Lure</label><br>
            <label><input type="checkbox" name="flags" value="grammar"> Grammar Issue</label><br>

            <h4>What would you do?</h4>

            <label><input type="radio" name="action" value="click" required> Click Link</label><br>
            <label><input type="radio" name="action" value="verify"> Verify on official website</label><br>
            <label><input type="radio" name="action" value="ignore"> Ignore message</label><br>
            <label><input type="radio" name="action" value="share"> Share OTP / Details</label><br><br>

            <button type="submit">Submit Answer</button>

        </form>
    </div>

</div>
<script>
document.getElementById("challengeForm").addEventListener("submit", function(e) {
    e.preventDefault();

    const formData = new FormData(this);

    fetch("/submit_round", {
        method: "POST",
        body: formData
    })
    .then(res => res.json())
    .then(data => {

        const feedbackDiv = document.createElement("div");
        feedbackDiv.classList.add("feedback-card");

        if (data.success) {
            feedbackDiv.classList.add("feedback-success");
            feedbackDiv.innerHTML = `
                <h3>Excellent Detection!</h3>
                <p>You correctly identified the manipulation tactics.</p>
                <p><strong>Updated Cyber Risk Score:</strong> ${data.score}</p>
            `;
        } else {
            feedbackDiv.classList.add("feedback-fail");
            feedbackDiv.innerHTML = `
                <h3>Be Careful!</h3>
                <p>You missed some warning signs or chose a risky action.</p>
                <p><strong>Updated Cyber Risk Score:</strong> ${data.score}</p>
            `;
        }

        feedbackDiv.style.marginTop = "20px";
        feedbackDiv.style.opacity = "0";
        feedbackDiv.style.transform = "translateY(20px)";
        feedbackDiv.style.transition = "all 0.5s ease";

        document.querySelector(".card").appendChild(feedbackDiv);

        setTimeout(() => {
            feedbackDiv.style.opacity = "1";
            feedbackDiv.style.transform = "translateY(0)";
        }, 50);

        if (!data.game_over) {
            const nextBtn = document.createElement("button");
            nextBtn.innerText = "Next Round";
            nextBtn.style.marginTop = "15px";
            nextBtn.onclick = function() {
                window.location.href = "/next_round";
            };
            feedbackDiv.appendChild(nextBtn);
        } else {
            const resultBtn = document.createElement("button");
            resultBtn.innerText = "See Final Result";
            resultBtn.style.marginTop = "15px";
            resultBtn.onclick = function() {
                window.location.href = "/result";
            };
            feedbackDiv.appendChild(resultBtn);
        }

        document.getElementById("challengeForm").querySelector("button").disabled = true;
    });
});
</script>
</body>
</html>